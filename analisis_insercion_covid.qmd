---
title: "Impacto de la Adaptación Pedagógica COVID-19 en la Inserción Laboral de los Graduados Universitarios Andaluces"
author: "Carlos Pérez, Daniel Limón, Joaquín Vidal"
date: last-modified
lang: es
format: 
  pdf:
    toc: false              # Índice de contenidos
    number-sections: true   # Numeración 1.1, 1.2...
    colorlinks: true        # Enlaces clicables en color
    papersize: a4           # Tamaño papel estándar europeo
    geometry:
      - top=25mm
      - left=25mm
      - right=25mm
      - bottom=25mm
    fig-pos: 'H'            # Intenta forzar que las gráficas salgan donde las pones
execute:
  warning: false
  message: false
---

\tableofcontents
\newpage

# Resumen
Este estudio analiza el impacto de la adaptación pedagógica forzosa por la pandemia de COVID-19 en la calidad de la inserción laboral de XX,XXX egresados de universidades públicas andaluzas2. Utilizando datos administrativos de la cohorte Pre-COVID (2018-2019) y las cohortes Post-COVID (2019-2023), examinamos la probabilidad de experimentar precariedad (definida como jornada parcial)3.El análisis descriptivo agregado inicial mostró una sorprendente estabilidad en las tasas de precariedad (~36%), a pesar de la disrupción educativa4. Sin embargo, la posterior Regresión Logística Binaria, controlando rigurosamente por la Rama de Conocimiento (GRUPO) y el Rendimiento Académico, reveló la existencia de una Paradoja de Simpson5.Los resultados indican que la estabilidad agregada se debió a un marcado efecto composición—un aumento en la proporción de egresados de ramas con menor precariedad estructural (como Salud y TIC)6. Una vez aisladas estas diferencias disciplinares, el efecto neto atribuible al periodo Post-COVID sobre la probabilidad de precariedad resultó ser estadísticamente nulo (OR $\approx$ 1)7.Concluimos que, a pesar del cambio pedagógico masivo, el impacto de la pandemia no introdujo una penalización adicional en la inserción laboral de los graduados andaluces una vez controlado el tipo de titulación. Este hallazgo subraya la robustez de la calidad del sistema universitario andaluz frente a shocks externos, al tiempo que enfatiza la persistencia de las desigualdades de inserción laboral preexistentes entre ramas.
\newpage

# Introducción
La irrupción de la pandemia de COVID-19 generó una disrupción sin precedentes en la educación superior a nivel global. El cambio forzoso y repentino a modelos de docencia online e híbrida supuso un desafío metodológico y didáctico para las universidades públicas andaluzas, afectando directamente la formación de las cohortes de graduados entre 2019-20231111111. La literatura preliminar sugiere que este cambio, al reducir el contacto presencial y las prácticas, podría haber comprometido el desarrollo de habilidades críticas no cognitivas (soft skills), planteando la hipótesis de un impacto negativo en la calidad de la inserción laboral de los egresados2222. En este contexto, el presente estudio tiene como objetivo determinar si el periodo de intervención Post-COVID ha incrementado la probabilidad de precariedad laboral (definida como empleo a jornada parcial) al primer año de egreso3333.Inicialmente, el análisis descriptivo agregado mostró un resultado contraintuitivo: una notable estabilidad en la tasa global de precariedad, que se mantuvo fluctuando en un margen estrecho en torno al 36% entre las cohortes Pre- y Post-COVID4444444. Esta estabilidad agregada podría llevar a concluir erróneamente que la pandemia no generó un impacto sistémico en el mercado laboral juvenil andaluz5. Sin embargo, la caracterización de la muestra reveló una variación estructural significativa ($p < 0.001$) en la composición de los egresados por Rama de Conocimiento (GRUPO)6666. Se observó un incremento del peso relativo de las titulaciones con históricamente baja precariedad (como Salud y TIC) y un descenso en ramas con precariedad estructural alta (como Educación)7777.Esta coexistencia de estabilidad en la media con cambios en la composición de la muestra sugiere la presencia de una Paradoja de Simpson8888. El hecho de que la tasa agregada se mantuviera estática, a pesar de que la muestra de egresados mejoró estructuralmente, indica que un posible efecto penalizador neto asociado a la formación COVID-19 podría haber sido enmascarado por un efecto composición positivo9999. Para resolver esta ambigüedad, se requiere ir más allá de los promedios simples10.El objetivo central de esta investigación es aislar el efecto neto de la intervención COVID-19. Para ello, se utiliza un Modelo de Regresión Logística Binaria que controla ceteris paribus por la Rama de Conocimiento (como principal variable estructural) y el Rendimiento Académico del graduado11. Nuestros hallazgos del análisis inferencial confirman el escenario de la Paradoja de Simpson y demuestran que, una vez controladas las diferencias disciplinares, el efecto neto del periodo Post-COVID es estadísticamente nulo sobre la probabilidad de precariedad121212121212121212. Esta conclusión subraya la primacía de los determinantes estructurales (la elección de la rama de estudio) sobre los efectos de la coyuntura pedagógica en la inserción laboral13131313.

\newpage

# Metodología: Construcción de la Base de Datos

## Fuente de Datos
Los datos primarios proceden de la *Encuesta de Inserción Laboral de los Egresados de Universidades Públicas de Andalucía*, facilitados por el Instituto de Estadística y Cartografía de Andalucía (IECA). El estudio abarca un periodo longitudinal de cinco cohortes académicas, desde el curso 2018-2019 hasta el 2022-2023.

## Procesamiento y Harmonización
Dado que la estructura de los microdatos originales presentaba variaciones anuales en el esquema de columnas y separadores de archivo, se implementó un algoritmo de armonización para consolidar los ficheros anuales en un único dataframe maestro.

El proceso de limpieza y filtrado siguió las siguientes reglas de negocio estrictas:

1.  **Universo de Estudio:** Se seleccionaron exclusivamente los egresados de Grado (`tipo_estudio = 1`), excluyendo másteres y doctorados para garantizar la homogeneidad de la muestra.
2.  **Tratamiento de Valores Perdidos:**
    * Se estandarizaron los códigos de "No consta" o "No aplica" (99, Q0) como valores perdidos (`NA`).
    * Se aplicó un criterio de *casos completos* para las variables críticas del estudio: Cohorte, Rendimiento Académico, Rama de Enseñanza y Situación Laboral al primer año.
3.  **Definición de Variables Derivadas:**
    * **Rama de Enseñanza (GRUPO):** Se reclasificó la variable `AMBITO` original (códigos de 4 dígitos) en 10 grandes grupos funcionales.
    * **Calidad de la Inserción:** Se generó una variable binaria `CalidadContrato` basada en la jornada laboral al primer año (`TJORNADAA1T3`), donde la jornada parcial se considera un indicador de precariedad (1) frente a la jornada completa (0).
    * *Justificación:* Esta decisión se fundamenta en la literatura sobre subempleo por insuficiencia de horas (labor slack). En el contexto del mercado laboral juvenil español, la parcialidad es predominantemente involuntaria y conlleva una penalización salarial directa, limitando la independencia económica del egresado.

```{r}
#| label: ingesta-datos
#| echo: true
#| results: 'hide'

files <- c(
  "./microdatos/MicrodatILEUPA2018.csv",
  "./microdatos/MicrodatILEUPA2019.csv",
  "./microdatos/MicrodatILEUPA2020.csv",
  "./microdatos/MicrodatILEUPA2021.csv",
  "./microdatos/MicrodatILEUPA2022.csv"
)

# --- Lector que autodetecta separador ("," o ";") ---
read_csv_auto <- function(path) {
  if (!is.character(path) || length(path) != 1) stop("Ruta no válida.")
  if (!file.exists(path)) stop(paste("No existe el archivo:", path))
  first_line <- readLines(path, n = 1, warn = FALSE)
  if (grepl(";", first_line)) {
    df <- read.csv2(path, stringsAsFactors = FALSE, check.names = FALSE)
  } else {
    df <- read.csv(path,  stringsAsFactors = FALSE, check.names = FALSE)
  }
  df
}

# Unimos los data.frames con distinto set de columnas, rellenando faltantes
# con NA)
rbind_union <- function(dflist) {
  all_names <- unique(unlist(lapply(dflist, names)))
  aligned <- lapply(dflist, function(x) {
    miss <- setdiff(all_names, names(x))
    if (length(miss) > 0) {
      for (m in miss) x[[m]] <- NA
    }
    x[, all_names, drop = FALSE]
  })
  do.call(rbind, aligned)
}

# --- Cargar todos los ficheros ---
lst <- lapply(files, read_csv_auto)
datos <- rbind_union(lst)
```

**Selección del Universo y Variables de Interés**

Sobre el conjunto consolidado, se aplicó un filtrado para restringir el análisis a las columnas relevantes (Renombrado de `CURSO` a `anio`) y al universo de egresados de Grado (`tipo_estudio == "1"`), excluyendo otros niveles formativos para garantizar la comparabilidad.


```{r}
#| label: seleccion-universo
#| echo: true
#| results: 'hide'

# Seleccionamos las columnas que nos interesan.
base_keep <- intersect(c("CURSO","TIPOESTUDIO","AMBITO","RENDIMIENTO"),
names(datos))

# Normalizamos nombres de las columnas
nm <- names(datos)
keep_extra <- nm[
  grepl("^ACTIVIDAD",  nm, ignore.case = TRUE) |
  grepl("^GRUPO_?COT", nm, ignore.case = TRUE) |  # GRUPOCOT o GRUPO_COT
  grepl("^TCONTRATO",  nm, ignore.case = TRUE) |
  grepl("^TJORNADA",   nm, ignore.case = TRUE)
]

cols_to_keep <- unique(c(base_keep, keep_extra))
tabla <- datos[, cols_to_keep, drop = FALSE]

# Renombramos CURSO -> anio, TIPOESTUDIO -> tipo_estudio
if ("CURSO" %in% names(tabla))
  names(tabla)[names(tabla) == "CURSO"] <- "anio"
if ("TIPOESTUDIO" %in% names(tabla))
  names(tabla)[names(tabla) == "TIPOESTUDIO"] <- "tipo_estudio"

datosdef=tabla[tabla$tipo_estudio=="1",]
```

**Tratamiento de Valores Ausentes (NAs)**

Se implementó una estrategia de limpieza estricta. Los códigos administrativos "99" (No consta) y "Q0" (Sin rendimiento) fueron recodificados como valores perdidos (NA). Posteriormente, se evaluó la tasa de completitud de los registros.


```{r}
#| label: limpieza-nas
#| echo: true
#| results: 'hide'

# Imputamos los NA a los 99
variables_objetivo_a_modificar <- c("GRUPOCOTA1T3","GRUPOCOTA2T3",
                                    "GRUPOCOTA3T3","GRUPOCOTA4T3",
                                    "TCONTRATOA1T3","TCONTRATOA2T3",
                                    "TCONTRATOA3T3","TCONTRATOA4T3",
                                    "TJORNADAA1T3","TJORNADAA2T3",
                                    "TJORNADAA3T3","TJORNADAA4T3")
for (col in variables_objetivo_a_modificar) {
  datosdef[[col]][datosdef[[col]] == 99] <- NA
}
# Imputamos los NA a los Q0
datosdef[["RENDIMIENTO"]][datosdef[["RENDIMIENTO"]] == "Q0"] <- NA

# 1) Conteo de NO-NA solo en las variables objetivo (+ RENDIMIENTO)
vars_target <- unique(c("RENDIMIENTO", variables_objetivo_a_modificar))
vars_target <- vars_target[vars_target %in% names(datosdef)]

# Tratamos cadenas vacías como NA
datosdef[datosdef == ""] <- NA
```

**Generación del Dataset Analítico (`datos_analisis`)**

Finalmente, se construyeron las variables derivadas necesarias para la contrastación de hipótesis:

1. Rama de Enseñanza (GRUPO): Normalización de la variable AMBITO.

2. Calidad del Contrato (`CalidadContrato`): Variable dicotómica donde la jornada parcial (`TJORNADAA1T3 == 2`) se codifica como 1 (baja calidad) y el resto como 0.

El conjunto final datos_analisis contiene únicamente los registros completos (complete.cases) para las variables críticas, formateados como factores ordenados.


```{r}
#| label: construccion-analisis
#| echo: true

# 1) Grupo
datosdef$GRUPO <- ifelse(datosdef$AMBITO == 9999,
                         NA_integer_,
                         datosdef$AMBITO %/% 100)

datosdef$AMBITO <- NULL

# 2) Filtrar filas con claves completas: anio, RENDIMIENTO, GRUPO
datosdef_ok <- datosdef[!is.na(datosdef$anio) &
                        !is.na(datosdef$RENDIMIENTO) &
                        !is.na(datosdef$GRUPO), ,drop = FALSE]

# 3) Construir dataset de análisis solo con las variables relevantes
vars_analisis <- c("anio", "RENDIMIENTO", "GRUPO", "TJORNADAA1T3")
vars_analisis <- vars_analisis[vars_analisis %in% names(datosdef_ok)]

datos_analisis <- datosdef_ok[, vars_analisis, drop = FALSE]

# 4) Eliminar casos sin información de jornada
datos_analisis <- datos_analisis[!is.na(datos_analisis$TJORNADAA1T3), ,
drop = FALSE]

# 5) Crear CalidadContrato SOLO a partir de TJORNADAA1T3
tmp <- datos_analisis$TJORNADAA1T3
if (is.character(tmp)) {
  suppressWarnings(tmp_num <- as.integer(tmp))
} else {
  tmp_num <- suppressWarnings(as.integer(tmp))
}

# Aquí asumimos:
#   CalidadContrato = 1 -> contrato de mala calidad si TJORNADAA1T3 == 2
#   CalidadContrato = 0 -> contrato de buena calidad si TJORNADAA1T3 != 2
datos_analisis$CalidadContrato <- ifelse(tmp_num == 2L, 1L, 0L)

# 6) Dejamos solo las columnas finales
datos_analisis <- datos_analisis[, c("anio", "RENDIMIENTO", "GRUPO",
                                     "TJORNADAA1T3", "CalidadContrato"),
                                 drop = FALSE]


datos_analisis$anio <- factor(datos_analisis$anio,
                              levels = c("2018-2019","2019-2020","2020-2021",
                                         "2021-2022","2022-2023"),
                              ordered = TRUE)

datos_analisis$RENDIMIENTO <- factor(datos_analisis$RENDIMIENTO,
                                     levels = c("Q1","Q2","Q3","Q4"),
                                     ordered = TRUE)
```

\newpage

# Resultados Descriptivos

Objetivo: Validar que los grupos son comparables y observar tendencias "a simple vista"

Antes de proceder al modelado econométrico, es fundamental caracterizar la muestra y verificar la comparabilidad entre las cohortes analizadas.

```{r}
#| label: preparacion-visual
#| echo: false
#| message: false

library(tidyverse)
library(dplyr)
library(ggplot2)

# CREACIÓN DE ETIQUETAS Y VARIABLES DE INTERVENCIÓN
# Transformamos los códigos numéricos en factores legibles para tablas y gráficos

datos_plot <- datos_analisis |> 
  mutate(
    # 1. Variable de Intervención (Corte en 2019-2020)
    periodo_covid = factor(
      if_else(anio == "2018-2019", "Pre-COVID", "Post-COVID"),
      levels = c("Pre-COVID", "Post-COVID")
    ),
    
    # 2. Etiquetas de Ramas (Mapping estricto)
    rama_enseny = factor(GRUPO, 
      levels = 1:10,
      labels = c("Educación", "Artes y Hum.", "CC. Sociales", "Empresa/Derecho", 
                 "CC. Naturales", "TIC", "Ingeniería", "Agri/Vet", 
                 "Salud", "Servicios")
    ),
    
    # 3. Etiqueta de Precariedad (Para visualización)
    situacion_laboral = factor(
      if_else(CalidadContrato == 1, "Jornada Parcial (Precaria)", "Jornada Completa"),
      levels = c("Jornada Completa", "Jornada Parcial (Precaria)")
    )
  )
```

## Caracterización de la Muestra
- Uso de gtsummary para comparar variables demográficas y académicas (Rendimiento, Rama) entre el grupo Control (2018-19) y Tratamiento (2019-23).

- Test estadístico de diferencias entre grupos (Chi-cuadrado).

La Tabla 1 resume las características sociodemográficas y académicas de los egresados, segmentadas por el periodo de intervención. Se han aplicado tests de independencia ($\chi^2$) para evaluar diferencias significativas en la composición de los grupos.

```{r}
#| label: tabla-descriptiva
#| tbl-cap: "Perfil de los egresados por periodo (Pre vs Post COVID)"
#| echo: false
#| message: false
#| warning: false

library(gtsummary)
library(kableExtra)

datos_plot |> 
  select(periodo_covid, rama_enseny, RENDIMIENTO, situacion_laboral) |> 
  tbl_summary(
    by = periodo_covid,
    label = list(
      rama_enseny ~ "Rama de Enseñanza",
      RENDIMIENTO ~ "Rendimiento (Cuartiles)", 
      situacion_laboral ~ "Calidad Inserción (Año 1)"
    ),
    statistic = all_categorical() ~ "{n} ({p}%)",
    percent = "column"
  ) |> 
  add_p() |>       
  add_overall() |> 
  bold_labels() |> 
  as_kable_extra(booktabs = TRUE) |> 
  kable_styling(latex_options = c("hold_position", "scale_down"))
```

### Interpretación de los Descriptivos

El análisis preliminar mostrado en la Tabla 1 revela tres hallazgos fundamentales que guían la estrategia de modelado posterior:

1.  **Estabilidad en la Tasa de Precariedad Agregada:** A nivel global, no se observa una diferencia significativa ($p > 0.9$) en la calidad de la inserción entre los periodos. Tanto antes como después de la pandemia, aproximadamente el 64% de los graduados accedieron a una jornada completa en su primer año. Esto sugiere que, en términos macroscópicos, el mercado laboral andaluz mostró resiliencia ante el shock.

2.  **Cambios Composicionales Significativos ($p < 0.001$):** Se detecta una variación estructural en la distribución por ramas de enseñanza. La cohorte Post-COVID presenta una ligera reducción en el peso relativo de ramas tradicionales como *Educación* (del 20% al 17%) y un incremento en ramas técnicas como *Ciencias Naturales*. Dado que la empleabilidad varía enormemente entre titulaciones, este cambio composicional justifica el uso de modelos multivariantes para controlar el "efecto rama" y evitar sesgos en la comparación.

3.  **Homogeneidad en el Rendimiento:** Es destacable que no existen diferencias significativas en los cuartiles de rendimiento ($p = 0.2$). Esto descarta la hipótesis de una "inflación de notas" generalizada durante la pandemia que pudiera distorsionar la variable de capacidad académica.

**Conclusión preliminar:** Aunque el indicador bruto de precariedad se mantiene estable, es necesario aislar el efecto de la intervención (COVID) de los cambios demográficos y estructurales mediante la regresión logística.

## Análisis Exploratorio Visual
- Gráfico de barras: Tasa de Precariedad (Jornada Parcial) por Rama de Enseñanza.

- Evolución temporal: Línea de tendencia de la precariedad a lo largo de los 5 años (para ver si hubo un "shock" en 2020).

Para complementar los estadísticos agregados y responder a la necesidad de una perspectiva longitudinal, se presentan dos visualizaciones clave.

En primer lugar, la **Figura 1** desglosa la tasa de precariedad por rama de enseñanza. Esto permite identificar visualmente qué sectores estructurales (como Salud o Educación) arrastran las tasas más altas o bajas, ayudando a explicar los cambios composicionales detectados en la Tabla 1.

```{r}
#| label: grafico-barras-rama
#| fig-cap: "Tasa de precariedad (Jornada Parcial) por Rama de Enseñanza"
#| fig-height: 5
#| echo: false

datos_plot |> 
  group_by(rama_enseny) |> 
  summarise(
    tasa_precariedad = mean(CalidadContrato, na.rm = TRUE),
    n = n()
  ) |> 
  ggplot(aes(x = reorder(rama_enseny, tasa_precariedad), y = tasa_precariedad)) +
  geom_col(fill = "#2C3E50", alpha = 0.8) +
  geom_text(aes(label = scales::percent(tasa_precariedad, accuracy = 0.1)), 
            hjust = -0.2, size = 3) +
  scale_y_continuous(labels = scales::percent, limits = c(0, 0.85)) +
  coord_flip() +
  labs(
    x = NULL,
    y = "Porcentaje de contratos a Jornada Parcial",
    title = "Precariedad Estructural por Rama",
    subtitle = "Promedio acumulado (2018-2023)"
  ) +
  theme_minimal()
```

Los datos revelan una brecha estructural severa. Ramas como Educación (65,8%) y Artes y Humanidades (56,7%) presentan tasas de parcialidad hasta doce veces superiores a las observadas en sectores técnicos como las TIC (5,5%) o la Ingeniería (10,4%). Esta disparidad sugiere que el riesgo de precariedad no es sistémico uniforme, sino que está fuertemente concentrado en sectores específicos vinculados tradicionalmente al sector público o servicios, mientras que las ramas STEM (Science, Technology, Engineering and Mathematics) actúan como refugios de estabilidad laboral.

En segundo lugar, y fundamental para este estudio, la **Figura 2** muestra la evolución temporal año a año. Este enfoque longitudinal permite discernir si la estabilidad observada en el promedio global (Tabla 1) es real o si esconde fluctuaciones anuales derivadas del shock pandémico inmediato y su posterior recuperación.

```{r}
#| label: grafico-temporal
#| fig-cap: "Evolución longitudinal de la precariedad laboral (2018-2023)"
#| echo: false

datos_plot |> 
  group_by(anio, periodo_covid) |> 
  summarise(
    tasa_precariedad = mean(CalidadContrato, na.rm = TRUE), 
    .groups = "drop"
  ) |> 
  ggplot(aes(x = anio, y = tasa_precariedad, group = 1)) +
  # Línea de tendencia
  geom_line(color = "#34495E", linewidth = 1) +
  # Puntos diferenciados por periodo
  geom_point(aes(color = periodo_covid), size = 4) +
  # Línea vertical marcando el inicio del cambio metodológico
  geom_vline(xintercept = 1.5, linetype = "dashed", color = "#E74C3C") +
  annotate("text", x = 1.6, y = 0.38, label = "Inicio COVID", 
           hjust = 0, size = 3, color = "#E74C3C", fontface = "bold") +
  # Escalas y colores
  scale_y_continuous(labels = scales::percent, limits = c(0.30, 0.40)) + # Zoom en la zona de interés
  scale_color_manual(values = c("Pre-COVID" = "#27AE60", "Post-COVID" = "#C0392B")) +
  labs(
    x = "Cohorte Académica",
    y = "Tasa de Jornada Parcial",
    color = "Periodo",
    title = "Evolución Temporal de la Calidad del Empleo"
  ) +
  theme_minimal() +
  theme(legend.position = "top")
```

Contrariamente a la hipótesis de un shock negativo masivo, la serie temporal muestra una notable estabilidad agregada. La tasa de jornada parcial fluctúa en una banda estrecha en torno al 36%. Si bien se aprecia un ligero repunte en la cohorte 2020-2021 (36,5%), coincidiendo con el periodo más agudo de restricciones, la tendencia revierte rápidamente hacia los niveles basales en 2022-2023. Esto confirma que, en términos agregados, el mercado laboral andaluz no experimentó una degradación estructural permanente de la calidad del empleo tras la pandemia.

### Análisis Descriptivo Estratificado por Rama de Conocimiento

#### Justificación del Desglose
Para aislar el efecto del cambio metodológico (COVID-19) de los shocks de demanda sectoriales, es imperativo desagregar el análisis por la variable `GRUPO`. El mercado laboral presenta una fuerte heterogeneidad estructural; agregar todas las ramas podría enmascarar tendencias divergentes (Sesgo de Agregación).

Mientras que sectores como Salud o TIC responden a dinámicas de alta demanda inelástica, otros como Artes y Humanidades o Servicios son más sensibles al ciclo económico y a las restricciones sanitarias. Este desglose permite identificar si el deterioro en la calidad de la inserción (medido como la proporción de Jornada Completa) es sistémico o específico de ciertas disciplinas.

#### Evolución de la Calidad del Empleo (Jornada Completa)
El siguiente análisis visual examina la prevalencia de la contratación a Jornada Completa (`TJORNADAA1T3 = 1`) a lo largo de las cohortes, segmentada por las 10 ramas de enseñanza. Se excluyen del cálculo los registros con valores "No consta" o "NA" para garantizar la precisión de la tasa.

```{r}
#| label: fig-evolucion-ramas
#| fig-cap: "Evolución de la Tasa de Jornada Completa por Rama de Enseñanza (2018-2023)"
#| fig-height: 8
#| fig-width: 10
#| echo: false
#| warning: false

# Preparación de datos agregados por Rama y Año
# IMPORTANTE: Filtramos TJORNADAA1T3 == 3 (No consta) y NAs para calcular la tasa real sobre válidos.

datos_tendencia_rama <- datos_plot |> 
  filter(!is.na(TJORNADAA1T3), TJORNADAA1T3 != 3, TJORNADAA1T3 != 99) |> 
  group_by(anio, rama_enseny, periodo_covid) |> 
  summarise(
    # Calculamos proporción de 1 (Jornada Completa)
    tasa_jornada_completa = mean(TJORNADAA1T3 == 1, na.rm = TRUE),
    n = n(),
    .groups = "drop"
  )

# Visualización de Facetas (Small Multiples)
ggplot(datos_tendencia_rama, aes(x = anio, y = tasa_jornada_completa, group = 1)) +
  
  # Áreas de referencia (opcional: sombrear zona COVID si se desea, aquí usamos línea vertical)
  geom_vline(xintercept = 1.5, linetype = "dashed", color = "gray50", alpha = 0.8) +
  
  # Línea de tendencia y Puntos
  geom_line(aes(color = tasa_jornada_completa), linewidth = 1) +
  geom_point(aes(color = tasa_jornada_completa), size = 2) +
  
  # Facetado por Rama
  facet_wrap(~rama_enseny, ncol = 3) + # 3 columnas para legibilidad
  
  # Escalas y Formato
  scale_y_continuous(labels = scales::percent_format(accuracy = 1), limits = c(0, 1)) +
  scale_color_gradient(low = "#E74C3C", high = "#27AE60", guide = "none") + # Semáforo visual (Rojo=Bajo, Verde=Alto)
  
  labs(
    x = NULL,
    y = "% Jornada Completa",
    title = "Calidad de la Inserción: Heterogeneidad por Ramas",
    subtitle = "La línea vertical indica el inicio de cohortes afectadas por COVID-19",
    caption = "Fuente: Elaboración propia. Se excluyen valores 'No consta'."
  ) +
  
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 7), # Rotar años para que quepan
    strip.text = element_text(face = "bold", size = 10), # Títulos de facetas más claros
    panel.grid.minor = element_blank()
  )
```

**Interpretación de la Dinámica por Ramas**

La **Figura 3** desglosa la evolución de la calidad del empleo (tasa de Jornada Completa) mediante un análisis de facetas (*small multiples*). Los patrones observados confirman una fuerte **heterogeneidad estructural** que domina sobre los efectos coyunturales de la pandemia:

1.  **Persistencia de la Precariedad en Humanidades y Educación:** Las ramas de *Educación* y *Artes y Humanidades* muestran tasas de jornada completa consistentemente bajas (30-45%). La pandemia no generó un punto de inflexión; la precariedad en estos sectores es un rasgo sistémico que precede y sucede a la crisis sanitaria.

2.  **Resiliencia de los Sectores STEM:** Las ramas de *TIC* e *Ingeniería* actúan como refugios laborales, con tasas de inserción de calidad superiores al 85-90%. La estabilidad es casi absoluta, sugiriendo que la demanda de perfiles técnicos fue inmune a las disrupciones pedagógicas o del mercado.

3.  **Volatilidad en Servicios:** Únicamente la rama de *Servicios* muestra una fluctuación compatible con un "shock COVID", con una caída clara en la cohorte 2019-2020 (~40%) y una recuperación posterior incompleta.

**Síntesis Descriptiva:** La línea vertical que marca el inicio del periodo COVID no coincide con rupturas estructurales en la mayoría de las ramas. Las variaciones interanuales son marginales comparadas con la brecha de hasta 70 puntos porcentuales entre ramas (ej. TIC vs. Educación). Esto evidencia que el determinante principal de la calidad del empleo es la elección de estudios, relegando el "efecto cohorte/COVID" a un segundo plano en el análisis visual.


## Síntesis: De la Estabilidad Agregada a la Necesidad del Control Multivariante

El recorrido descriptivo realizado hasta este punto arroja una evidencia contraintuitiva respecto a la hipótesis de partida ($H_1$). A pesar de las disrupciones pedagógicas y el cierre de prácticas presenciales, las series temporales no muestran un colapso estructural en la calidad del empleo a nivel agregado, manteniéndose la tasa de precariedad en torno al 36% tanto antes como después de la pandemia.

Sin embargo, concluir que el impacto fue nulo sería prematuro y estadísticamente arriesgado debido a dos factores detectados en la caracterización de la muestra:

1.  **Significatividad Estadística vs. Estabilidad Agregada:** Si bien la tasa de éxito laboral es estable, la **Tabla 1** reveló diferencias significativas ($p < 0.001$) en la composición de los egresados. El perfil del estudiante "post-COVID" no es idéntico al "pre-COVID": hubo un ligero aumento en la proporción de egresados de ramas con alta empleabilidad (como Ciencias y Salud) y un descenso en ramas más precarias (como Educación).
2.  **Posible Efecto de Enmascaramiento (Efecto Composición):** Podríamos estar ante un escenario de *Paradoja de Simpson*. Si la composición de la muestra mejoró estructuralmente (más ingenieros y sanitarios), la tasa global de inserción debería haber aumentado. El hecho de que se mantuviera estática sugiere la existencia de fuerzas contrapuestas:
    * Un **Efecto Composición Positivo** (más graduados en carreras de alta demanda).
    * Un posible **Efecto Tratamiento Negativo** (penalización por formación COVID) que ha sido "maquillado" por el primero.

**Justificación del Modelo Inferencial:**
Para validar si existe una penalización real asociada a la generación COVID, es imperativo trascender los promedios simples. El análisis inferencial que sigue tiene como objetivo "congelar" matemáticamente estas variables de confusión. Solo mediante una regresión logística que controle *ceteris paribus* por rama de enseñanza, sexo y rendimiento, podremos aislar el **efecto neto** de la pandemia y determinar si, a igualdad de condiciones, un egresado post-COVID enfrenta mayores barreras de entrada al mercado laboral de calidad.

\newpage

# Análisis Inferencial

Objetivo: Aislar el efecto COVID de otras variables confusoras

Variable Intervención y modelo:

```{r}
#| label: creacion-intervencion-y-ajuste

#| echo: true

#| results: 'show'

# CARGA DE LIBRERÍAS NECESARIAS

library(dplyr)

library(ggplot2)

library(gtsummary)

library(broom)

# 1. CREACIÓN DE LA VARIABLE DE INTERVENCIÓN (Post-COVID)

# La variable de intervención es el predictor clave para testar el efecto neto.

# Definición: Pre-COVID (2018-2019) vs. Post-COVID (2019-2020 en adelante)

datos_analisis <- datos_analisis %>%

  mutate(

    # Crear la variable binaria

    Post_COVID = case_when(

      anio == "2018-2019" ~ "Pre-COVID (Referencia)",

      anio %in% c("2019-2020", "2020-2021", "2021-2022", "2022-2023") ~ "Post-COVID",

      TRUE ~ NA_character_

    ),

    # Asegurar que sea factor y la categoría de referencia sea Pre-COVID

    Post_COVID = factor(Post_COVID, 

                        levels = c("Pre-COVID (Referencia)", "Post-COVID"))

  ) %>%

  # Asegurar que GRUPO y RENDIMIENTO sean factores para el modelo

  mutate(

    GRUPO = factor(GRUPO),

    RENDIMIENTO = factor(RENDIMIENTO)

  ) %>%

  # Eliminar NAs si quedan, aunque ya se hizo previamente

  filter(!is.na(Post_COVID)) 

# 2. ESPECIFICACIÓN Y AJUSTE DEL MODELO LOGÍSTICO

# VD: CalidadContrato (Prob. de Precariedad, donde 1 es Precariedad)

# VIs: Post_COVID (Foco), GRUPO (Control Obligatorio), RENDIMIENTO (Control)

modelo_logistico <- glm(

  CalidadContrato ~ Post_COVID + GRUPO + RENDIMIENTO,

  data = datos_analisis,

  family = binomial(link = "logit")

)

# 3. PRESENTACIÓN DE RESULTADOS CON gtsummary (Tabla Académica)

tabla_modelo <- modelo_logistico %>%

  tbl_regression(

    exponentiate = TRUE, # Mostrar Odds Ratios (OR) en lugar de log-odds

    label = list(

      Post_COVID ~ "Periodo de Intervención",

      GRUPO ~ "Rama de Conocimiento",

      RENDIMIENTO ~ "Rendimiento Académico"

    ),

    pvalue_fun = ~style_pvalue(.x, digits = 3) # Formato de p-valor

  ) %>%

  # Añadir el N del modelo y la bondad de ajuste

  add_n() %>%

  add_glance_source_note(label = list(

    N = "N (Casos completos)",

    AIC = "Criterio de Información de Akaike"

  )) %>%

  # Añadir el nombre del modelo

  modify_caption("**Tabla 1. Resultados de la Regresión Logística (Odds Ratios)**")

# Imprimir la tabla

tabla_modelo

```
## Resultados del Modelo Logístico

La Tabla 1 presenta los efectos estimados por la regresión logística para la probabilidad de insertarse en un empleo precario (jornada parcial) durante el primer año. El foco principal del análisis es evaluar si el periodo Post-COVID implica un riesgo diferencial de precariedad una vez controladas variables estructurales clave como la rama de conocimiento y el rendimiento académico.

Efecto del Periodo Post-COVID

El Odds Ratio asociado al periodo Post-COVID es 1.02 (IC95%: 0.97–1.07; p = 0.458), lo que indica que, a igualdad de rama y rendimiento, no existe un incremento estadísticamente significativo en la probabilidad de precariedad para los egresados formados durante o después del COVID-19.

Este resultado es coherente con la estabilidad observada en los descriptivos agregados y sugiere que el impacto pedagógico de la pandemia no generó un deterioro sistemático en la calidad del empleo, una vez aislados los efectos de composición entre cohortes. En términos prácticos, un egresado post-COVID presenta prácticamente el mismo riesgo de precariedad que uno pre-COVID, tras ajustar por características estructuralmente relevantes.

Brechas Estructurales entre Ramas de Conocimiento

Los coeficientes de las ramas revelan un patrón extremadamente marcado. Todas las ramas presentan OR muy inferiores a 1 respecto a la categoría de referencia (Rama 1), con valores que oscilan entre 0.68 (Rama 2) y 0.03 (Rama 6), todos ellos con p < 0.001. Estas diferencias representan variaciones de hasta treinta veces en el riesgo de precariedad, confirmando que la rama de estudios es el determinante más fuerte y persistente de la calidad de la inserción laboral.

Este hallazgo replica fielmente la heterogeneidad identificada en los análisis descriptivos: existen ramas estructuralmente vulnerables con elevada exposición a la jornada parcial, y ramas (especialmente STEM y ciertas áreas técnicas) donde la probabilidad de precariedad es ínfima. En consecuencia, las diferencias disciplinares eclipsan completamente el efecto del periodo COVID.

Efecto del Rendimiento Académico

El rendimiento académico también muestra un gradiente claro. Los niveles inferiores (Q, L, C) presentan OR entre 0.91 y 0.96, con significación estadística (p < 0.05). Aunque el efecto es menos intenso que el de la rama, estos valores muestran que peores niveles de rendimiento se asocian a un incremento moderado de la probabilidad de precariedad.

La magnitud de los efectos indica que el desempeño académico actúa como un factor relevante, pero secundario respecto a la rama de conocimiento.

Forest Plot:

```{r}
#| label: forest-plot-odds-ratios

#| echo: true

#| fig-height: 8 # Altura ajustada para acomodar todos los coeficientes

#| fig-width: 9

library(dplyr)

library(ggplot2)

library(broom)

# 1. EXTRACCIÓN Y TRANSFORMACIÓN DE COEFICIENTES (broom)

# Usamos tidy para extraer coeficientes, transformamos a OR e IC

datos_forest <- tidy(modelo_logistico, exponentiate = TRUE, conf.int = TRUE) %>%

  # Limpieza de nombres de términos para el gráfico

  mutate(

    # Simplificar el nombre de la categoría Post-COVID

    term = case_match(

      term,

      "Post_COVIDPost-COVID" ~ "Post-COVID vs Pre-COVID",

      .default = term

    ),

    # Etiquetar GRUPO y RENDIMIENTO para la visualización

    TermLabel = case_when(

      grepl("^GRUPO", term) ~ paste0("Rama ", sub("GRUPO", "", term)),

      grepl("^RENDIMIENTO", term) ~ paste0("Rendimiento ", sub("RENDIMIENTO", "", term)),

      TRUE ~ term

    ),

    # Reordenar las categorías para un plot limpio: COVID, Rendimiento, Ramas

    Categoria = case_when(

      term == "Post-COVID vs Pre-COVID" ~ "A. Intervención Temporal (Foco)",

      grepl("^Rendimiento", TermLabel) ~ "B. Rendimiento Académico",

      TRUE ~ "C. Ramas de Conocimiento"

    )

  ) %>%

  # Excluir el intercepto (no interpretable) y ordenar por Categoría

  filter(term != "(Intercept)") %>%

  arrange(Categoria, estimate)

# 2. GENERACIÓN DEL FOREST PLOT (ggplot2 minimalista)

forest_plot <- datos_forest %>%

  ggplot(aes(x = estimate, y = reorder(TermLabel, estimate))) +

  

  # Añadir la línea de referencia (Odds Ratio = 1)

  geom_vline(xintercept = 1, linetype = "dashed", color = "gray50", linewidth = 0.8) +

  

  # Dibujar los Intervalos de Confianza (IC 95%)

  geom_errorbarh(aes(xmin = conf.low, xmax = conf.high), height = 0.2, 

                 color = "gray30") +

  

  # Dibujar los Odds Ratios (puntos)

  geom_point(aes(color = Categoria), size = 3) +

  

  # Estilo y etiquetas

  labs(

    title = "Odds Ratios de Precariedad (Jornada Parcial) por Periodo, Rama y Rendimiento",

    subtitle = "Modelo Logístico ajustado por variables confusoras. (Referencia: Pre-COVID, Intercepto de GRUPO y Q1 de Rendimiento)",

    x = "Odds Ratio (OR) — Mayor Precariedad ⟶",

    y = ""

  ) +

  

  # Separar en facetas (opcional, pero ayuda a la lectura)

  facet_grid(Categoria ~ ., scales = "free_y", space = "free_y") +

  

  # Estética (Minimalista y académica)

  theme_bw() +

  theme(

    legend.position = "none",

    axis.text.y = element_text(face = "bold"),

    plot.title = element_text(face = "bold"),

    strip.text.y = element_text(face = "bold")

  ) +

  

  # Escala logarítmica para ORs (mejora la simetría visual)

  scale_x_log10(breaks = c(0.25, 0.5, 1, 2, 4)) +

  

  # Colores (ajustables)

  scale_color_manual(values = c("A. Intervención Temporal (Foco)" = "#B22222", 

                                "B. Rendimiento Académico" = "#006400", 

                                "C. Ramas de Conocimiento" = "#1E90FF"))

# Imprimir el gráfico

forest_plot
```
Interpretación General del Forest Plot

El Forest Plot visualiza estos resultados de forma sintética:

1.  El efecto del COVID aparece centrado alrededor de OR = 1, con un intervalo que cruza ampliamente la línea de no-efecto. Esto confirma su irrelevancia estadística en el contexto multivariante.

2.  Los efectos del rendimiento se agrupan cerca de OR = 1 pero con desplazamientos suficientes para indicar un gradiente de riesgo real, aunque limitado.

3.  Las ramas, en contraste, se encuentran muy por debajo de OR = 1, ocupando prácticamente toda la parte izquierda de la escala. Esto evidencia que el nivel de precariedad es un fenómeno eminentemente estructural, asociado a diferencias entre disciplinas y no al periodo temporal o a la coyuntura COVID.

##Conclusión Inferencial

El análisis inferencial confirma que la estabilidad agregada observada en las tasas de precariedad no se debe a ausencia de cambios, sino a la coexistencia de dos dinámicas contrapuestas:

* Un marcadísimo efecto composición: en el periodo post-COVID aumenta el peso de ramas con baja precariedad estructural.

* Un efecto neto COVID estadísticamente nulo: a igualdad de características, el COVID no empeora la probabilidad de acceder a una jornada completa.

El resultado es consistente con una Paradoja de Simpson: el promedio se mantiene estable no porque nada haya cambiado, sino porque cambió quién se gradúa. Sin embargo, una vez controladas las diferencias disciplinares y de rendimiento, el COVID no introduce penalización adicional alguna en la inserción laboral.

## Especificación del Modelo
- Regresión Logística Binaria (glm).

- VD: Probabilidad de Precariedad (CalidadContrato == 1).

- VIs: Periodo COVID + Rama + Rendimiento Académico.

## Resultados del Modelo
- Presentación de Odds Ratios (OR) e intervalos de confianza.

- Forest Plot: Visualización de los coeficientes para ver qué ramas protegen más contra la precariedad.

\newpage

# Discusión y Conclusiones

## Interpretación
¿Se confirma la hipótesis? (Si OR > 1 en periodo COVID, sí afectó).

## Matices por rama
¿Afectó a todas las carreras por igual o sufrieron más las que requieren presencialidad (ej. Ciencias vs Humanidades)?

## Limitaciones
Uso de datos administrativos (sin datos de habilidades blandas). Esto ya lo podemos hablar y consideramos si hacemos mención de las soft skills o no.
